<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>File Manager</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      height: 100vh;
      overflow: hidden;
    }

    .container {
      display: flex;
      height: 100vh;
    }

    .sidebar {
      width: 250px;
      background: #2c3e50;
      color: white;
      padding: 20px;
    }

    .sidebar h2 {
      margin-bottom: 20px;
      font-size: 18px;
    }

    .nav-item {
      padding: 12px 15px;
      margin: 5px 0;
      cursor: pointer;
      border-radius: 6px;
      transition: background 0.2s;
    }

    .nav-item:hover {
      background: #34495e;
    }

    .nav-item.active {
      background: #3498db;
    }

    .main-content {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
    }

    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    h1 {
      margin-bottom: 30px;
      color: #2c3e50;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
      margin-right: 10px;
    }

    .btn-primary {
      background: #3498db;
      color: white;
    }

    .btn-primary:hover {
      background: #2980b9;
    }

    .btn-danger {
      background: #e74c3c;
      color: white;
    }

    .btn-danger:hover {
      background: #c0392b;
    }

    .btn-success {
      background: #2ecc71;
      color: white;
    }

    .btn-success:hover {
      background: #27ae60;
    }

    .folder-list {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .folder-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      border-bottom: 1px solid #ecf0f1;
    }

    .folder-item:last-child {
      border-bottom: none;
    }

    .folder-path {
      flex: 1;
      font-family: monospace;
      font-size: 13px;
      color: #555;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      margin: 10px 0;
    }

    .status-watching {
      background: #2ecc71;
      color: white;
    }

    .status-stopped {
      background: #95a5a6;
      color: white;
    }

    table {
      width: 100%;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      border-collapse: collapse;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ecf0f1;
    }

    th {
      background: #34495e;
      color: white;
      font-weight: 600;
      cursor: pointer;
      user-select: none;
    }

    th:hover {
      background: #2c3e50;
    }

    tr:hover {
      background: #f8f9fa;
    }

    .settings-group {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .settings-group h3 {
      margin-bottom: 15px;
      color: #2c3e50;
    }

    .setting-item {
      margin: 15px 0;
    }

    .setting-item label {
      display: block;
      margin-bottom: 8px;
      color: #555;
      font-weight: 500;
    }

    input[type="range"] {
      width: 100%;
      max-width: 400px;
    }

    .range-value {
      display: inline-block;
      margin-left: 15px;
      font-weight: 600;
      color: #3498db;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #95a5a6;
    }

    .empty-state svg {
      width: 80px;
      height: 80px;
      margin-bottom: 20px;
      opacity: 0.3;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="sidebar">
      <h2>üìÅ File Manager</h2>
      <div class="nav-item active" data-screen="organize">Organize Files</div>
      <div class="nav-item" data-screen="old-files">Old Files</div>
      <div class="nav-item" data-screen="settings">Settings</div>
    </div>

    <div class="main-content">
      <!-- Organize Files Screen -->
      <div class="screen active" id="organize">
        <h1>Organize Files</h1>
        
        <button class="btn btn-primary" id="selectFoldersBtn">+ Add Folders to Watch</button>
        <button class="btn btn-success" id="organizeNowBtn">Organize Now</button>
        <button class="btn btn-danger" id="stopWatchingBtn">Stop Watching</button>
        
        <div class="status-badge status-stopped" id="watchStatus">Not Watching</div>

        <div class="folder-list" id="folderList">
          <div class="empty-state">
            <p>No folders selected. Click "Add Folders to Watch" to get started.</p>
          </div>
        </div>

        <div id="organizeResults"></div>
      </div>

      <!-- Old Files Screen -->
      <div class="screen" id="old-files">
        <h1>Find Old Files</h1>
        
        <button class="btn btn-primary" id="scanOldFilesBtn">Scan for Old Files</button>
        <button class="btn btn-danger" id="deleteSelectedBtn" style="display:none;">Delete Selected</button>

        <div id="oldFilesTable" style="margin-top: 20px;"></div>
      </div>

      <!-- Settings Screen -->
      <div class="screen" id="settings">
        <h1>Settings</h1>

        <div class="settings-group">
          <h3>File Age Threshold</h3>
          <div class="setting-item">
            <label for="ageThreshold">
              Consider files older than: <span class="range-value" id="ageValue">3 years</span>
            </label>
            <input type="range" id="ageThreshold" min="1" max="10" value="3">
          </div>
        </div>

        <div class="settings-group">
          <h3>Auto-Organization</h3>
          <div class="setting-item">
            <label>
              <input type="checkbox" id="autoOrganize"> Automatically organize files periodically
            </label>
          </div>
          <div class="setting-item" id="intervalSetting" style="display: none;">
            <label for="checkInterval">
              Check and organize every: <span class="range-value" id="intervalValue">60 minutes</span>
            </label>
            <input type="range" id="checkInterval" min="15" max="360" step="15" value="60">
            <div style="display: flex; justify-content: space-between; max-width: 400px; margin-top: 5px; font-size: 12px; color: #95a5a6;">
              <span>15 min</span>
              <span>1 hr</span>
              <span>3 hrs</span>
              <span>6 hrs</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let watchedFolders = [];
    let oldFilesData = [];
    let ageThresholdYears = 3;
    let autoOrganizeEnabled = false;
    let checkIntervalMinutes = 60;

    // Navigation
    document.querySelectorAll('.nav-item').forEach(item => {
      item.addEventListener('click', () => {
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        
        item.classList.add('active');
        const screenId = item.getAttribute('data-screen');
        document.getElementById(screenId).classList.add('active');
      });
    });

    // Select Folders
    document.getElementById('selectFoldersBtn').addEventListener('click', async () => {
      const folders = await window.electronAPI.selectFolders();
      if (folders && folders.length > 0) {
        watchedFolders = [...new Set([...watchedFolders, ...folders])];
        renderFolderList();
      }
    });

    // Organize Now
    document.getElementById('organizeNowBtn').addEventListener('click', async () => {
      if (watchedFolders.length === 0) {
        alert('Please select folders first');
        return;
      }

      for (const folder of watchedFolders) {
        const result = await window.electronAPI.organizeFiles(folder);
        if (result.success) {
          showOrganizeResults(result.data);
        } else {
          alert('Error: ' + result.error);
        }
      }
    });

    // Start/Stop Watching
    document.getElementById('stopWatchingBtn').addEventListener('click', async () => {
      await window.electronAPI.stopWatching();
      updateWatchStatus(false);
    });

    // Scan Old Files
    document.getElementById('scanOldFilesBtn').addEventListener('click', async () => {
      if (watchedFolders.length === 0) {
        alert('Please select folders first');
        return;
      }

      oldFilesData = [];
      for (const folder of watchedFolders) {
        const result = await window.electronAPI.scanOldFiles(folder, ageThresholdYears);
        if (result.success) {
          oldFilesData = [...oldFilesData, ...result.data];
        }
      }
      renderOldFilesTable();
    });

    // Delete Selected Files
    document.getElementById('deleteSelectedBtn').addEventListener('click', async () => {
      const selected = oldFilesData.filter((_, i) => 
        document.getElementById(`check-${i}`).checked
      );
      
      if (selected.length === 0) {
        alert('No files selected');
        return;
      }

      if (confirm(`Delete ${selected.length} files?`)) {
        const paths = selected.map(f => f.path);
        await window.electronAPI.deleteFiles(paths);
        oldFilesData = oldFilesData.filter(f => !paths.includes(f.path));
        renderOldFilesTable();
      }
    });

    // Age Threshold Slider
    document.getElementById('ageThreshold').addEventListener('input', (e) => {
      ageThresholdYears = parseInt(e.target.value);
      document.getElementById('ageValue').textContent = `${ageThresholdYears} years`;
    });

    // Auto-Organize Checkbox
    document.getElementById('autoOrganize').addEventListener('change', async (e) => {
      autoOrganizeEnabled = e.target.checked;
      document.getElementById('intervalSetting').style.display = autoOrganizeEnabled ? 'block' : 'none';
      
      await window.electronAPI.updateAutoOrganize(autoOrganizeEnabled, checkIntervalMinutes);
      
      // If we have folders and auto-organize is enabled, restart watching with new settings
      if (watchedFolders.length > 0) {
        await window.electronAPI.startWatching(watchedFolders, autoOrganizeEnabled, checkIntervalMinutes);
        updateWatchStatus(true, autoOrganizeEnabled);
      }
    });

    // Check Interval Slider
    document.getElementById('checkInterval').addEventListener('input', async (e) => {
      checkIntervalMinutes = parseInt(e.target.value);
      const hours = Math.floor(checkIntervalMinutes / 60);
      const mins = checkIntervalMinutes % 60;
      
      let displayText = '';
      if (hours > 0 && mins > 0) {
        displayText = `${hours} hr ${mins} min`;
      } else if (hours > 0) {
        displayText = `${hours} hr`;
      } else {
        displayText = `${mins} min`;
      }
      
      document.getElementById('intervalValue').textContent = displayText;
      
      await window.electronAPI.updateAutoOrganize(autoOrganizeEnabled, checkIntervalMinutes);
      
      // Restart watching if already active
      if (watchedFolders.length > 0 && autoOrganizeEnabled) {
        await window.electronAPI.startWatching(watchedFolders, autoOrganizeEnabled, checkIntervalMinutes);
      }
    });

    // Render Functions
    function renderFolderList() {
      const list = document.getElementById('folderList');
      if (watchedFolders.length === 0) {
        list.innerHTML = '<div class="empty-state"><p>No folders selected</p></div>';
        return;
      }

      list.innerHTML = watchedFolders.map(folder => `
        <div class="folder-item">
          <div class="folder-path">${folder}</div>
          <button class="btn btn-danger" onclick="removeFolder('${folder}')">Remove</button>
        </div>
      `).join('');

      window.electronAPI.startWatching(watchedFolders, autoOrganizeEnabled, checkIntervalMinutes);
      updateWatchStatus(true, autoOrganizeEnabled);
    }

    function removeFolder(folder) {
      watchedFolders = watchedFolders.filter(f => f !== folder);
      renderFolderList();
    }

    function updateWatchStatus(watching, autoOrg = false) {
      const badge = document.getElementById('watchStatus');
      let statusText = watching ? 'Watching' : 'Not Watching';
      if (watching && autoOrg) {
        statusText += ' (Auto-Organize ON)';
      }
      badge.textContent = statusText;
      badge.className = `status-badge ${watching ? 'status-watching' : 'status-stopped'}`;
    }

    function showOrganizeResults(data) {
      const results = document.getElementById('organizeResults');
      const entries = Object.entries(data);
      results.innerHTML = `
        <div class="folder-list">
          <h3>Organization Complete</h3>
          ${entries.map(([ext, count]) => `
            <div class="folder-item">
              <div>${ext}: ${count} files</div>
            </div>
          `).join('')}
        </div>
      `;
    }

    function renderOldFilesTable() {
      const container = document.getElementById('oldFilesTable');
      const deleteBtn = document.getElementById('deleteSelectedBtn');
      
      if (oldFilesData.length === 0) {
        container.innerHTML = '<div class="empty-state"><p>No old files found</p></div>';
        deleteBtn.style.display = 'none';
        return;
      }

      deleteBtn.style.display = 'inline-block';
      
      const totalSize = oldFilesData.reduce((sum, f) => sum + f.size, 0);
      const formatSize = (bytes) => {
        const mb = bytes / (1024 * 1024);
        return mb > 1024 ? `${(mb/1024).toFixed(2)} GB` : `${mb.toFixed(2)} MB`;
      };

      container.innerHTML = `
        <p>Found ${oldFilesData.length} files (Total: ${formatSize(totalSize)})</p>
        <table>
          <thead>
            <tr>
              <th><input type="checkbox" id="selectAll"></th>
              <th>File Name</th>
              <th>Size</th>
              <th>Modified</th>
            </tr>
          </thead>
          <tbody>
            ${oldFilesData.map((file, i) => `
              <tr>
                <td><input type="checkbox" id="check-${i}"></td>
                <td>${file.name}</td>
                <td>${formatSize(file.size)}</td>
                <td>${new Date(file.modified).toLocaleDateString()}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;

      document.getElementById('selectAll').addEventListener('change', (e) => {
        oldFilesData.forEach((_, i) => {
          document.getElementById(`check-${i}`).checked = e.target.checked;
        });
      });
    }
  </script>
</body>
</html>